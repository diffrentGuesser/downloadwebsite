<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image â†’ Text (OCR)</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    :root {
      --bg: #0f1117; 
      --panel:#161b22; 
      --muted:#9aa4b2; 
      --text:#e6edf3; 
      --accent:#4aa8ff; 
      --ok:#3fb950; 
      --warn:#d29922; 
      --err:#f85149;
      --border:#2c313c;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; 
      background: linear-gradient(135deg, #0f1117, #1a1f29);
      color: var(--text); 
      font: 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
    }

    header { 
      padding: 18px 24px; 
      border-bottom: 1px solid var(--border); 
      display:flex; 
      align-items:center; 
      gap:14px; 
      background: var(--panel);
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      position: sticky; top: 0; z-index: 10;
    }
    header h1 { font-size: 18px; margin:0; }
    header .spacer { flex:1; }
    header .btn { padding:10px 16px; border-radius:12px; background: var(--accent); border:none; color:white; cursor:pointer; transition: all 0.2s ease; }
    header .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }

    .layout { display:grid; grid-template-columns: minmax(340px, 520px) 1fr; gap: 16px; height: calc(100% - 66px); padding: 16px; }
    @media (max-width: 900px) { .layout { grid-template-columns: 1fr; height:auto; } }

    .panel { background: var(--panel); border:1px solid var(--border); border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); }

    /* Upload zone */
    .upload-container { padding: 30px; text-align: center; cursor: pointer; transition: 0.3s; border: 2px dashed var(--border); border-radius: 14px; }
    .upload-container:hover { border-color: var(--accent); background: rgba(74,168,255,0.05); }
    #file-input { display:none; }
    .upload-container h2 { margin: 0 0 10px; font-size: 18px; color: var(--accent); }
    .upload-container .muted { color: var(--muted); font-size: 13px; }

    /* Queue */
    .queue { margin-top: 16px; max-height: 50vh; overflow-y: auto; padding: 8px; display:flex; flex-direction:column; gap:12px; }
    .item { display:flex; gap:14px; padding:12px; border:1px solid var(--border); border-radius: 12px; background:#111621; transition: transform 0.2s; }
    .item:hover { transform: translateY(-2px); }
    .item.error { border-color: var(--err); }
    .thumb { width: 70px; height: 70px; border-radius: 10px; background:#0c0f18; overflow:hidden; flex-shrink: 0; }
    .thumb img { width:100%; height:100%; object-fit:cover; }
    .meta { flex:1; min-width: 0; }
    .meta .name { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; font-weight: 600; }
    .progress { height: 8px; background:#0c0f18; border-radius:6px; overflow:hidden; margin-top:8px; }
    .bar { height: 100%; width: 0%; background: var(--accent); transition: width 0.2s linear; border-radius: 6px; }
    .status { font-size: 12px; color: var(--muted); margin-top:6px; }
    .status.error { color: var(--err); }

    /* Right panel */
    .right .panel { height: calc(100% - 0px); display:flex; flex-direction: column; }
    .toolbar { display:flex; gap:10px; padding: 12px; border-bottom:1px solid var(--border); }
    .toolbar .btn { padding:10px 14px; border:none; border-radius: 10px; background: var(--accent); color:#fff; cursor:pointer; transition:0.2s; }
    .toolbar .btn:hover { filter: brightness(1.1); transform: translateY(-1px); }
    .toolbar .pill { margin-left:auto; padding: 6px 12px; border-radius:999px; font-size:12px; color: var(--muted); background:#0c0f18; }
    textarea { flex:1; width:100%; resize:none; padding: 16px; background: #0c0f18; color: var(--text); border:0; outline:none; font: 14px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono"; border-bottom-left-radius: 16px; border-bottom-right-radius: 16px; }

    footer { padding: 10px 16px; font-size:12px; color:var(--muted); border-top:1px solid var(--border); }

    /* Toast notifications */
    .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
    .toast { padding: 12px 16px; border-radius: 10px; background: #1c212e; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0,0,0,0.4); font-size: 14px; animation: toastIn 0.3s ease-out; }
    .toast.error { border-color: var(--err); }
    .toast.success { border-color: var(--ok); }
    .toast.warning { border-color: var(--warn); }
    @keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes toastOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ“– Image â†’ Text (OCR)</h1>
    <div class="spacer"></div>
    <button id="clearAllBtn" class="btn">Clear</button>
  </header>

  <div class="layout">
    <section class="left">
      <div class="panel">
        <label class="upload-container" for="file-input">
          <input type="file" id="file-input" accept="image/*" multiple>
          <h2>Upload Images</h2>
          <div class="muted">Click or drag images anywhere on the page</div>
        </label>
        <div class="queue" id="queue"></div>
      </div>
    </section>

    <section class="right">
      <div class="panel">
        <div class="toolbar">
          <button class="btn" id="copyBtn">Copy all text</button>
          <button class="btn" id="downloadBtn">Download .txt</button>
          <span class="pill" id="statusPill">Idle</span>
        </div>
        <textarea id="output" placeholder="Extracted text will appear here..."></textarea>
        <footer>OCR powered by <a href="https://github.com/naptha/tesseract.js" target="_blank" style="color:var(--accent)">Tesseract.js</a>. Everything runs locally.</footer>
      </div>
    </section>
  </div>

  <div class="toast-container" id="toastContainer"></div>

<script>
(() => {
  const fileInput = document.getElementById('file-input');
  const queueEl = document.getElementById('queue');
  const outputEl = document.getElementById('output');
  const copyBtn = document.getElementById('copyBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const clearAllBtn = document.getElementById('clearAllBtn');
  const statusPill = document.getElementById('statusPill');
  const toastContainer = document.getElementById('toastContainer');

  let queue = [];
  let processing = false;
  let idCounter = 0;

  const supportedTypes = ['image/jpeg', 'image/png', 'image/bmp', 'image/webp'];

  function showToast(message, type = 'normal') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    toastContainer.appendChild(toast);
    setTimeout(() => { toast.style.animation = 'toastOut 0.3s ease-out forwards'; setTimeout(() => toast.remove(), 300); }, 3000);
  }
  function setStatus(text) { statusPill.textContent = text; }

  function bytesToNice(n) {
    if (n < 1024) return `${n} B`;
    const u = ['KB','MB','GB']; let i = -1; 
    do { n = n/1024; i++; } while (n >= 1024 && i < u.length - 1);
    return `${n.toFixed(1)} ${u[i]}`;
  }

  function createItem(file) {
    const id = ++idCounter;
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <div class="thumb"><span>â€¦</span></div>
      <div class="meta">
        <div class="name">${file.name}</div>
        <div class="muted">${bytesToNice(file.size)}</div>
        <div class="progress"><div class="bar"></div></div>
        <div class="status">Queued</div>
      </div>`;
    const thumb = el.querySelector('.thumb');
    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.onload = () => URL.revokeObjectURL(img.src);
    thumb.innerHTML = ''; thumb.appendChild(img);

    const bar = el.querySelector('.bar');
    const statusEl = el.querySelector('.status');
    queueEl.appendChild(el);
    const item = { id, file, name: file.name, el, bar, statusEl };
    queue.push(item);
    return item;
  }

  function handleFiles(files) {
    if (!files || !files.length) return;
    let validFiles = 0;
    for (const file of files) {
      if (supportedTypes.includes(file.type)) {
        createItem(file); validFiles++;
      } else {
        showToast(`Skipped ${file.name}: Unsupported type`, 'warning');
      }
    }
    if (validFiles > 0) { showToast(`Added ${validFiles} file(s)`, 'success'); processQueue(); }
  }

  fileInput.addEventListener('change', e => handleFiles(e.target.files));
  document.body.addEventListener('dragover', e => { e.preventDefault(); document.body.classList.add('dragover'); });
  document.body.addEventListener('dragleave', () => document.body.classList.remove('dragover'));
  document.body.addEventListener('drop', e => { e.preventDefault(); document.body.classList.remove('dragover'); handleFiles(e.dataTransfer.files); });

  async function processQueue() {
    if (processing) return;
    processing = true; setStatus('Processingâ€¦');
    while (queue.length) {
      const item = queue[0]; await ocrItem(item); queue.shift();
    }
    setStatus('Idle'); processing = false;
  }

  async function ocrItem(item) {
    const { file, bar, statusEl, name, el } = item;
    statusEl.textContent = 'Recognizingâ€¦';
    try {
      const { data } = await Tesseract.recognize(file, 'eng', {
        logger: (m) => { if (m.progress != null) { const p = Math.round(m.progress*100); bar.style.width = p+'%'; statusEl.textContent = `${m.status} (${p}%)`; } }
      });
      bar.style.width = '100%'; statusEl.textContent = 'Done'; statusEl.style.color = 'var(--ok)';
      appendOutput(data.text || '');
    } catch (err) {
      statusEl.textContent = 'Error'; statusEl.classList.add('error'); el.classList.add('error');
      appendOutput(`[[ OCR ERROR: ${err.message || err} ]]`);
      showToast(`Failed to process ${name}`, 'error');
    }
  }

  function appendOutput(text) {
    const clean = text.trim(); if (!clean) return;
    const sep = outputEl.value.trim().length ? '\n\n' : '';
    outputEl.value += sep + clean; outputEl.scrollTop = outputEl.scrollHeight;
  }

  copyBtn.addEventListener('click', async () => {
    if (!outputEl.value.trim()) return showToast('No text to copy', 'warning');
    try { await navigator.clipboard.writeText(outputEl.value); showToast('Copied', 'success'); }
    catch { showToast('Copy failed', 'error'); }
  });

  downloadBtn.addEventListener('click', () => {
    if (!outputEl.value.trim()) return showToast('No text to download', 'warning');
    const blob = new Blob([outputEl.value], { type: 'text/plain' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'extracted-text.txt';
    document.body.appendChild(a); a.click(); a.remove();
    showToast('Text downloaded', 'success');
  });

  clearAllBtn.addEventListener('click', () => {
    queue = []; processing = false; queueEl.innerHTML = ''; outputEl.value = '';
    setStatus('Cleared'); showToast('Cleared', 'success'); setTimeout(() => setStatus('Idle'), 1000);
  });
})();
</script>
</body>
</html>
